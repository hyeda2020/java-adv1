# 11. ExecutorService 우아한 종료
- 우아한 종료 : 서버 기능을 업데이트를 위해서 서버를 재시작해야 할 때,  
  새로운 요청이 오는 것은 막고, 이미 진행중인 작업이 모두 완료한 다음에 재시작 하는 것 처럼 문제 없이 서비스를 종료하는 것.  
  

- `ExecutorService` 의 종료 메서드
  - `void shutdown()` : 새로운 작업을 받지 않고, 이미 제출된 작업(BlockingQueue에 있는 작업들 포함)을 모두 완료한 후에 종료.  
  - `List<Runnable> shutdownNow()` : 실행 중인 작업을 중단하고, 대기 중인 작업을 반환하며 즉시 종료.
  - `close()` : shutdown() 을 호출하고, 작업이 완료되거나 인터럽트가 발생할 때 까지 무한정 반복 대기.

  
- `Executor` 스레드 풀 관리  
  1. 스레드 풀의 스레드 수가 coreSize를 넘어가면 추가 요청 작업은 큐에 보관.  
  2. 큐가 가득 차면 maxSize 만큼 추가 스레드를 생성하여 작업 수행.  
  3. 큐와 스레드 풀도 가득 차면 추가 요청 거절.  
  4. 이후 작업들이 완료되고 나서 max 스레드는 지정된 시간까지 작업을 수행하지 않고 대기하면 자동으로 제거.
    
  <img width="846" height="405" alt="스크린샷 2026-01-20 223132" src="https://github.com/user-attachments/assets/c2006999-7a3f-4099-8607-baf7bd439de5" />
  <img width="832" height="350" alt="스크린샷 2026-01-20 223159" src="https://github.com/user-attachments/assets/b3f92edd-77f5-4aa6-860a-8565842f2e9f" />
  <img width="828" height="366" alt="스크린샷 2026-01-20 223208" src="https://github.com/user-attachments/assets/b30c7e46-1992-4651-8365-f44ef9b617bd" />
  <img width="859" height="408" alt="스크린샷 2026-01-20 223220" src="https://github.com/user-attachments/assets/d58a62fa-fbd8-4549-be3c-ab98dd62e796" />
  <img width="831" height="424" alt="스크린샷 2026-01-20 223232" src="https://github.com/user-attachments/assets/4bccc6e4-30bb-4fbd-bc5b-6698f3d2aafe" />
  
- 스레드 미리 생성하기  
  응답시간이 아주 중요한 서버인 경우, 스레드를 미리 생성해두면, 처음 요청에서 사용되는 스레드의 생성 시간을 줄일 수 있음.  
  `ThreadPoolExecutor.prestartAllCoreThreads()` 를 사용하면 기본 스레드를 미리 생성할 수 있음.  
  단, `ExecutorService` 는 이 메서드를 제공하지 않음.  
  ```
  public static void main(String[] args) {
      ExecutorService es = Executors.newFixedThreadPool(1000);
      ThreadPoolExecutor poolExecutor = (ThreadPoolExecutor) es;
      poolExecutor.prestartAllCoreThreads();
  }
  ```
