# 4. 동기화 - synchronized
- 동시성 문제 : 공유 자원(Critical Section)에 여러 스레드가 동시에 접근하여 값이 변경되어 예상치 못한 동작이 발생하는 경우  
- 아래 소스코드를 수행하는 스레드가 두 개 이상일 때,  
  공유자원 `balance`의 값을 비교하거나 변경하는 로직에 거의 동시에 두 스레드가 접근할 경우,  
  의도치 않게 금액이 두 번 인출되었음에도 잔액은 한 번 인출된 것 처럼 남거나 하는 상황이 발생할 수 있음.
  ```
  // balance 가 공유 자원이라고 가정
  public boolean withdraw(int amount) {
    ...
    if (balance < amount) {
      return false;
    }
    balance = balance - amount;
    return true;
  }
  ```
  
- `synchronized` 메서드 : 자바의 synchronized 키워드를 사용하면 한 번에 하나의 스레드만 실행할 수 있는 코드 구간을 만들 수 있음.
    - 작동 방식 : 모든 객체(인스턴스)는 내부에 자신만의 락(lock)을 가지고 있으며,  
      스레드가 `synchronized` 키워드가 있는 메서드에 진입하려면 반드시 해당 인스턴스의 락이 있어야 함.  

  ```
  public synchronized boolean withdraw(int amount) { // synchronized 메서드 적용
    ...
    if (balance < amount) {
      return false;
    }
    balance = balance - amount;
    return true;
  }
  ```


- `synchronized` 코드 블럭 : `synchronized`의 가장 큰 장점이자 단점은 한 번에 하나의 스레드만 실행할 수 있다는 점이므로,  
  여러 스레드가 동시에 실행하지 못하기 때문에, 전체로 보면 성능이 떨어질 수 있음.  
  따라서, `synchronized` 를 메서드 전체에 일괄적으로 적용하기 보다는 꼭 필요한 곳으로 한정해서 설정하는 것이 중요.
  ```
  public boolean withdraw(int amount) {
    ...
    synchronized { // synchronized 구간 적용
        if (balance < amount) {
          return false;
        }
        balance = balance - amount;
    }
    return true;
  }
  ```